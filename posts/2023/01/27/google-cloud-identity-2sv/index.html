<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/theme.min.95e92366236e3eeadc2635f8c1c7b97ec3640de0147fa10ee1d281d56d40ee1aeb2c76977676599f543a2a682fd96d8cb9633a4fc700e537e46f8ba9d58df9f2.css integrity="sha512-lekjZiNuPurcJjX4wce5fsNkDeAUf6EO4dKB1W1A7hrrLHaXdnZZn1Q6Kmgv2W2MuWM6T8cA5Tfkb4up1Y358g=="><link rel=stylesheet href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg==" media=print onload='this.media="all"'><noscript><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg=="></noscript><title>Google Cloud Identity で2段階認証を強制する | fukasawah.github.io</title></head><body><header><p><a href=https://fukasawah.github.io/>fukasawah.github.io</a></p></header><main><article><header><h1>Google Cloud Identity で2段階認証を強制する</h1></header><aside class=toc><nav id=TableOfContents><ul><li><a href=#google-cloud-identityで2段階認証を強制したい管理者作業>Google Cloud Identityで2段階認証を強制したい（管理者作業）</a></li><li><a href=#2段階認証を設定する管理者ユーザ作業>2段階認証を設定する（管理者・ユーザ作業）</a></li><li><a href=#気になる点>気になる点</a><ul><li><a href=#2段階認証プロセスの選択と初回で選べるプロセス>2段階認証プロセスの「選択」と、初回で選べるプロセス</a></li><li><a href=#2段階認証の初回設定時に認証システム-アプリが選べないんだけど>2段階認証の初回設定時に「認証システム アプリ」が選べないんだけど？</a></li><li><a href=#ログイン済みのユーザがいる状態で2段階認証を強制したらどうなるか>ログイン済みのユーザがいる状態で2段階認証を強制したらどうなるか？</a></li><li><a href=#猶予期間中にログインしたらどうなるのか>猶予期間中にログインしたらどうなるのか？</a></li><li><a href=#猶予期間外にログインしたらどうなるのか>猶予期間外にログインしたらどうなるのか？</a></li></ul></li></ul></nav></aside><p>Google Workspace用の設定が良く出てくるが、今回はGoogle Cloud Identityで設定したい。</p><h2 id=google-cloud-identityで2段階認証を強制したい管理者作業>Google Cloud Identityで2段階認証を強制したい（管理者作業）</h2><p><a href=https://admin.google.com/>管理者画面</a>にある <a href=https://admin.google.com/u/3/ac/security/2sv>2段階認証</a> から行える模様。</p><p><figure><a href=images/index/2023-01-27-04-59-53.png target=_blank onclick=showOverlay(event)><picture><source type=image/webp srcset=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-04-59-53_huc7e5061de6a762e5943389e346d8b7cd_265904_500x500_fit_q80_h2_box_3.webp width=500 height=381><img src=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-04-59-53_huc7e5061de6a762e5943389e346d8b7cd_265904_500x500_fit_q80_bgffffff_box_3.jpg width=500 height=381 loading=lazy></picture></a></figure></p><p>以下は設定したほうがよさそう。</p><ul><li>新しいユーザーの登録期間: 猶予を与えてやらないとユーザ作成後、即座に締め出されてしまう（ログインもできなくなる）</li><li>方法: まずは「全て」がよさそう。電話を認めないと多分大変。後述。</li></ul><p>設定したら保存。</p><p><figure><a href=images/index/2023-01-27-04-54-46.png target=_blank onclick=showOverlay(event)><picture><source type=image/webp srcset=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-04-54-46_hu0ef61c48dd4dde5d08638c5c845d261d_47666_500x500_fit_q80_h2_box_3.webp width=500 height=257><img src=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-04-54-46_hu0ef61c48dd4dde5d08638c5c845d261d_47666_500x500_fit_q80_bgffffff_box_3.jpg width=500 height=257 loading=lazy></picture></a></figure></p><p>設定すると「まずお前からだ」といわれるので設定する。手順はユーザと同じなので次を参考。</p><h2 id=2段階認証を設定する管理者ユーザ作業>2段階認証を設定する（管理者・ユーザ作業）</h2><p>この作業はGoogleアカウントも Google Cloud identityで管理されているアカウントでも同様に行えるはず。</p><p>[https://myaccount.google.com/security] を開き、「2段階認証プロセス」を選択して設定していくだけ。</p><p>2段階認証プロセスは以下が用意されている。</p><ul><li>セキュリティキー: Yubikeyや生体認証装置を使った物理キーを使った認証</li><li>Googleからのメッセージ（Googleアプリ）: スマートフォンにGoogleアプリを導入し、デバイスで認証する</li><li>認証システム アプリ: Google AuthenticatorやMicrosoft Authenticator等のTOTPを発行できるアプリで認証する</li><li>音声またはテキストメッセージ: 電話による通話かSMSを使ったワンタイムパスワードを入力して認証する</li><li>バックアップコード: ランダムに払い出された番号を記憶して起き、ログイン時に使うことで認証する。1個につき1回限り。</li></ul><p>まずは「認証システム アプリ」が無難。SMSや電話は手軽だが、認証コードの通知が待ち受けに出たり、電話はそのまま出たりできてしまう。なのでデバイスさえ入手出来たら見れてしまうため内部犯とかに弱い。（それでも所有を認証にできるのでパスワードのみと比べたら充分強固）</p><p>・・・なのだけど、このうち「認証システム アプリ」と「バックアップコード」は選べなかった。</p><h2 id=気になる点>気になる点</h2><h3 id=2段階認証プロセスの選択と初回で選べるプロセス>2段階認証プロセスの「選択」と、初回で選べるプロセス</h3><p>Googleが提供してる2段階認証の方法は以下がある。</p><p><figure><a href=images/index/2023-01-27-05-38-05.png target=_blank onclick=showOverlay(event)><picture><source type=image/webp srcset=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-05-38-05_hu8ca86439fc26f79f124d221958ae0e79_206978_500x500_fit_q80_h2_box_3.webp width=353 height=500><img src=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-05-38-05_hu8ca86439fc26f79f124d221958ae0e79_206978_500x500_fit_q80_bgffffff_box_3.jpg alt=これは設定後の画面 width=353 height=500 loading=lazy></picture></a><figcaption>これは設定後の画面</figcaption></figure></p><p>それに対して方法の選択が「全て」「テキスト～確認コード以外」「セキュリティキーのみ 」なぜか3つしかない。</p><p>どれを選べばどれができるのか？わからなかったので試してみた。</p><table><thead><tr><th>「方法」の選択</th><th>セキュリティキー</th><th>Google アプリ</th><th>音声またはテキストメッセージ</th><th>認証システム アプリ</th><th>バックアップ コード</th></tr></thead><tbody><tr><td>全て</td><td>◯</td><td>◯</td><td>◯</td><td>-</td><td>-</td></tr><tr><td>テキスト～確認コード以外</td><td>◯</td><td>◯</td><td>-</td><td>-</td><td>-</td></tr><tr><td>セキュリティキーのみ</td><td>◯</td><td>-</td><td>-</td><td>-</td><td>-</td></tr></tbody></table><p>2023/01/27時点：なぜか「認証システム アプリ」が何故か初手では選べない（後から追加で設定はできる）</p><p>なのでまずは「全て」が良いかと思う。</p><h3 id=2段階認証の初回設定時に認証システム-アプリが選べないんだけど>2段階認証の初回設定時に「認証システム アプリ」が選べないんだけど？</h3><p>上述の通り「認証システム アプリ」は初回に選択できないが、後から設定することができる。</p><p>ちょっと面倒だが最初は「音声またはテキストメッセージ」で登録を済ませ、後から追加で「認証システム アプリ」を登録する。その状態ならば「音声またはテキストメッセージ」を削除することができる。</p><p>ちなみに、バックアップ コードは2段階認証としては認められないらしく、これだけを残すことはできなさそうだった。（デバイスを持たない人しか使えないのでそういうものだと思う）</p><h3 id=ログイン済みのユーザがいる状態で2段階認証を強制したらどうなるか>ログイン済みのユーザがいる状態で2段階認証を強制したらどうなるか？</h3><p>既存のログイン済みのユーザには即座に2段階認証がかからずログインしたまま作業できてしまうので注意する（20分程度では反映されなかっただけかもしれない）</p><p>ログアウトして新たにログインしようとすると、ちゃんと警告が出る。</p><h3 id=猶予期間中にログインしたらどうなるのか>猶予期間中にログインしたらどうなるのか？</h3><p>猶予の期間内だとログイン時は以下のような画面が出て、設定画面に遷移するか、無視することができる。設定しましょう。</p><p><figure><a href=images/index/2023-01-27-05-23-00.png target=_blank onclick=showOverlay(event)><picture><source type=image/webp srcset=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-05-23-00_hu684fd2a1c55548a17219d6a03108d651_115195_500x500_fit_q80_h2_box_3.webp width=439 height=500><img src=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-05-23-00_hu684fd2a1c55548a17219d6a03108d651_115195_500x500_fit_q80_bgffffff_box_3.jpg width=439 height=500 loading=lazy></picture></a></figure></p><h3 id=猶予期間外にログインしたらどうなるのか>猶予期間外にログインしたらどうなるのか？</h3><p>締め出しを食らった状態になる。猶予期間は設けたほうがよいでしょう。</p><p><figure><a href=images/index/2023-01-27-05-05-48.png target=_blank onclick=showOverlay(event)><picture><source type=image/webp srcset=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-05-05-48_hufabd85cd71444172953c01fe19564995_46209_500x500_fit_q80_h2_box_3.webp width=423 height=500><img src=/posts/2023/01/27/google-cloud-identity-2sv/images/index/2023-01-27-05-05-48_hufabd85cd71444172953c01fe19564995_46209_500x500_fit_q80_bgffffff_box_3.jpg width=423 height=500 loading=lazy></picture></a></figure></p><footer><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://fukasawah.github.io/tags/google-cloud>#Google Cloud</a></span>
<span class=tag><a href=https://fukasawah.github.io/tags/google-cloud-identity>#Google Cloud Identity</a></span></p><p>Created at: 2023-01-27 06:16 +0900<br>Updated at: 2023-01-27 06:16 +0900 <a href=https://github.com/fukasawah/blog/commit/314462933249210bc4580638dff661f13d512de9 target=_blank rel=noopener>#3144629</a></p><p><a href=https://fukasawah.github.io/posts/2023/02/12/manage-google-cloud-iam-with-google-group/><span title="Google CloudのIAM管理にGoogle Groupを使う">&lt; Next</span></a>
|
<a href=https://fukasawah.github.io/posts/><span title=Posts>Posts</span></a>
|
<a href=https://fukasawah.github.io/posts/2023/01/27/google-cloud-identity/><span title="Google Cloud Identityを始める">Prev ></span></a></p></footer></article><script src=https://fukasawah.github.io/js/theme-posts.min.526bf4c8dff80bed936c62a06f7bc8c02703fad621e3dd2ba243812d43c40b98397ff1951e5905c790b97c38633d42a0e35bf5314fdf9fcfbce31b18181b8ae3.js integrity="sha512-Umv0yN/4C+2TbGKgb3vIwCcD+tYh490rokOBLUPEC5g5f/GVHlkFx5C5fDhjPUKg41v1MU/fn8+84xsYGBuK4w==" defer></script></main><footer><p>&copy; 2024 <a href=https://fukasawah.github.io/>fukasawah</a></p></footer></body></html>