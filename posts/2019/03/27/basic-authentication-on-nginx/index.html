<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/theme.min.9d12c4e634f802b98375ad90880492251ec9d3f73bc320dab9d903811246e0b42c708c1a8d50717f9b1babc9feb6efa75bb5d414cf501a45ec86f4d77731b4a9.css integrity="sha512-nRLE5jT4ArmDda2QiASSJR7J0/c7wyDaudkDgRJG4LQscIwajVBxf5sbq8n+tu+nW7XUFM9QGkXshvTXdzG0qQ=="><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg=="><title>fukasawah.github.io | Basic Authentication on Nginx</title></head><body><header><p><a href=https://fukasawah.github.io/>fukasawah.github.io</a></p></header><main><article><header><h1>Basic Authentication on Nginx</h1></header><p>Apache Httpdのツールとして提供されている<code>htpasswd</code>コマンドを使うのが良い。
（最初はpythonで自前で計算しようとしたが、<a href=https://svn.apache.org/viewvc/apr/apr/trunk/crypto/>思っていた以上に面倒だった</a>ので諦めた&mldr;）</p><pre tabindex=0><code>yum install httpd-tools
</code></pre><p><code>htpasswd</code>の利用法は以下のドキュメント。</p><p><a href=https://httpd.apache.org/docs/2.4/misc/password_encryptions.html>https://httpd.apache.org/docs/2.4/misc/password_encryptions.html</a></p><p>こんな感じに作る。新規作成時は<code>-c</code>をつける</p><pre tabindex=0><code>$ sudo htpasswd -c -m /etc/nginx/.htpasswd testuser
New password:
Re-type new password:
Adding password for user testuser
</code></pre><p>ただ、出来上がるファイルは誰でも読める状態になっており、nginxユーザ(グループ)から読める必要があるため、<code>644</code>から<code>640</code>に変え、グループを<code>nginx</code>に変更する。</p><pre tabindex=0><code>sudo chmod 0640 /etc/nginx/.htpasswd
sudo chown :nginx /etc/nginx/.htpasswd
</code></pre><p>最後にnginx.confの設定を変える。設定のドキュメントは以下。</p><p><a href=https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html>https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html</a></p><p>以下をhttp,server,locationのいずれかのディレクティブに追加する。
locationなら特定のpathなら認証不要といった事ができる。</p><pre tabindex=0><code>    auth_basic           &#34;need authenticate&#34;;
    auth_basic_user_file /etc/nginx/.htpasswd;
</code></pre><p>後はnginxをreloadして反映。</p><footer><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://fukasawah.github.io/tags/server>#Server</a></span>
<span class=tag><a href=https://fukasawah.github.io/tags/nginx>#Nginx</a></span></p><p>Created at: 2019-03-27 02:08 +0900<br>Updated at: 2019-03-27 02:30 +0900 <a href=https://github.com/fukasawah/blog/commit/27b1d25714c466f072707196fb026ad8d882cd3d target=_blank rel=noopener>#27b1d25</a></p><p><a href=https://fukasawah.github.io/posts/2019/05/18/report-jjug-ccc-2019-spring/><span title="JJUG CCC 2019 Spring いってきた">&lt; Next</span></a>
|
<a href=https://fukasawah.github.io/posts/><span title=Posts>Posts</span></a>
|
<a href=https://fukasawah.github.io/posts/2019/03/26/virtualhost-nginx-with-wildcard-ssl/><span title=NginxのVirtualhost設定～WildcardSSL証明書を添えて～>Prev ></span></a></p></footer></article><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//fukasawah.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<script src=https://fukasawah.github.io/js/theme-posts.min.526bf4c8dff80bed936c62a06f7bc8c02703fad621e3dd2ba243812d43c40b98397ff1951e5905c790b97c38633d42a0e35bf5314fdf9fcfbce31b18181b8ae3.js integrity="sha512-Umv0yN/4C+2TbGKgb3vIwCcD+tYh490rokOBLUPEC5g5f/GVHlkFx5C5fDhjPUKg41v1MU/fn8+84xsYGBuK4w==" defer></script></main><footer><p>&copy; 2022 <a href=https://fukasawah.github.io/>fukasawah</a></p></footer></body></html>