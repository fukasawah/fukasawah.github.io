<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/theme.min.95e92366236e3eeadc2635f8c1c7b97ec3640de0147fa10ee1d281d56d40ee1aeb2c76977676599f543a2a682fd96d8cb9633a4fc700e537e46f8ba9d58df9f2.css integrity="sha512-lekjZiNuPurcJjX4wce5fsNkDeAUf6EO4dKB1W1A7hrrLHaXdnZZn1Q6Kmgv2W2MuWM6T8cA5Tfkb4up1Y358g=="><link rel=stylesheet href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg==" media=print onload='this.media="all"'><noscript><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg=="></noscript><title>Bashのtimeは複合コマンドにも使える | fukasawah.github.io</title></head><body><header><p><a href=https://fukasawah.github.io/>fukasawah.github.io</a></p></header><main><article><header><h1>Bashのtimeは複合コマンドにも使える</h1></header><p>bashのtimeは実行に要した時間がわかる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>time</span> seq <span class=m>1</span> <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=m>1</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=m>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real    0m0.045s
</span></span><span class=line><span class=cl>user    0m0.000s
</span></span><span class=line><span class=cl>sys     0m0.015s
</span></span></code></pre></div><p>で、これはコマンドでもビルトインコマンドでもなく、パイプラインで使う「予約語」であるらしく、timeの後ろには任意の<strong>bashのコマンド</strong>が書ける。</p><p><a href=https://linuxjm.osdn.jp/html/GNU_bash/man1/bash.1.html#lbAM>https://linuxjm.osdn.jp/html/GNU_bash/man1/bash.1.html#lbAM</a></p><p>例えば２つ以上のコマンドの実行にかかった時間が知りたいときを考える。</p><p>timeがもし「普通のコマンド」であれば多分こうするしかない。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>time</span> bash -c <span class=s1>&#39;seq 1 100 | sed &#34;s#\(.*\)#\1.dat#&#34;&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># もしくは１回ファイルに書き出してから測る</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;seq 1 100 | sed &#34;s#\(.*\)#\1.dat#&#34;&#39;</span> &gt; test.sh
</span></span><span class=line><span class=cl><span class=nb>time</span> bash test.sh
</span></span></code></pre></div><p>しかし、timeの後ろにはbashの複合コマンドも使えるのでこう書ける。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># サブシェルで実行</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> <span class=o>(</span>seq <span class=m>1</span> <span class=m>100</span> <span class=p>|</span> sed <span class=s2>&#34;s#\(.*\)#\1.dat#&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 同シェルで実行（末尾のセミコロンの付け忘れに注意）</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> <span class=o>{</span> seq <span class=m>1</span> <span class=m>100</span> <span class=p>|</span> sed <span class=s2>&#34;s#\(.*\)#\1.dat#&#34;</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># forで</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> <span class=k>for</span> i in <span class=sb>`</span>seq <span class=m>1</span> 100<span class=sb>`</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>.dat&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># whileも</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> <span class=k>while</span> <span class=nb>read</span> line <span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$line</span><span class=s2>.dat&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span> &lt; &lt;<span class=o>(</span>seq <span class=m>1</span> 100<span class=o>)</span>
</span></span></code></pre></div><p>これで思いつきでたくさんコマンドを組み合わせた場合でも簡単に時間が測れる。</p><p>bashの予約語のtimeの話なので、<code>/usr/bin/time</code> を使う方法では当然ダメ。</p><footer><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://fukasawah.github.io/tags/bash>#Bash</a></span></p><p>Created at: 2020-04-14 17:03 +0900<br>Updated at: 2020-04-14 17:42 +0900 <a href=https://github.com/fukasawah/blog/commit/22b0668a5e91a6d171446e6a180bb81488b1c2b8 target=_blank rel=noopener>#22b0668</a></p><p><a href=https://fukasawah.github.io/posts/2020/05/04/hello-libgit2/><span title=libgit2を使ってみる>&lt; Next</span></a>
|
<a href=https://fukasawah.github.io/posts/><span title=Posts>Posts</span></a>
|
<a href=https://fukasawah.github.io/posts/2020/04/08/frep/><span title="テンプレートエンジン frep">Prev ></span></a></p></footer></article><script src=https://fukasawah.github.io/js/theme-posts.min.526bf4c8dff80bed936c62a06f7bc8c02703fad621e3dd2ba243812d43c40b98397ff1951e5905c790b97c38633d42a0e35bf5314fdf9fcfbce31b18181b8ae3.js integrity="sha512-Umv0yN/4C+2TbGKgb3vIwCcD+tYh490rokOBLUPEC5g5f/GVHlkFx5C5fDhjPUKg41v1MU/fn8+84xsYGBuK4w==" defer></script></main><footer><p>&copy; 2024 <a href=https://fukasawah.github.io/>fukasawah</a></p></footer></body></html>