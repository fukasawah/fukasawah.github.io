<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/theme.min.391035d85598d9cdc041b227d96b2555ef35b637ce1d139220f675b8a1f8a8a92f13751d67b1c41c401bc24dc9045879034a239101583d4a77425d9233713074.css integrity="sha512-ORA12FWY2c3AQbIn2WslVe81tjfOHROSIPZ1uKH4qKkvE3UdZ7HEHEAbwk3JBFh5A0ojkQFYPUp3Ql2SM3EwdA=="><link rel=stylesheet href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg==" media=print onload='this.media="all"'><noscript><link rel=stylesheet type=text/css href=https://fukasawah.github.io/css/syntax.min.9d0044b0ce135aff3405271be2a17805c5ae03ec48f146191dc4b30923424c76fe7c6086323aa2cbf83affd41e11fef907f33b6cd685fe3645043bb79f63509a.css integrity="sha512-nQBEsM4TWv80BScb4qF4BcWuA+xI8UYZHcSzCSNCTHb+fGCGMjqiy/g6/9QeEf75B/M7bNaF/jZFBDu3n2NQmg=="></noscript><title>fukasawah.github.io | GitHub Actionsを使ってHugoのコンテンツをデプロイ</title></head><body><header><p><a href=https://fukasawah.github.io/>fukasawah.github.io</a></p></header><main><article><header><h1>GitHub Actionsを使ってHugoのコンテンツをデプロイ</h1></header><p>GitHub Actionsを使ってHugoをデプロイするのは以下を行えば簡単にできる。</p><p><a href=https://github.com/peaceiris/actions-hugo>https://github.com/peaceiris/actions-hugo</a></p><p>外部リポジトリにPushするためのデプロイキーの設定をした。この手順もドキュメントにちゃんと書いてあった。</p><ul><li><a href=https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-deploy_key>https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-deploy_key</a></li><li><a href=https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-create-ssh-deploy-key>https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-create-ssh-deploy-key</a></li></ul><p>というわけで、ワークフローはこんな感じになった。</p><p><a href=https://github.com/fukasawah/blog/blob/master/.github/workflows/gh-pages.yml>https://github.com/fukasawah/blog/blob/master/.github/workflows/gh-pages.yml</a></p><p>以下、ハマったところ。</p><h3 id=タイムゾーンが違う>タイムゾーンが違う</h3><p>Actionsでデプロイされた内容を見てみたら表示されてる日時のタイムゾーンがUTCになってた。</p><p>原因はGitHub Actionsで動いているコンテナが日本のタイムゾーンではないため。考えてみれば当たり前という感じだった。</p><p>以下を参考に <code>TZ</code> 環境変数を設定して実行するようにした。</p><p><a href=https://discourse.gohugo.io/t/dateformat-force-a-specific-timezone/9860/2>https://discourse.gohugo.io/t/dateformat-force-a-specific-timezone/9860/2</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>TZ=Asia/Tokyo hugo --minify</span><span class=w>
</span></span></span></code></pre></div><h3 id=actioncheckoutが---depth-1-を使っている>action@checkoutが <code>--depth 1</code> を使っている</h3><p>enableGitInfoでコミット時の情報を使う機能が機能しなかった。</p><p>原因はaction@checkoutが <code>--depth 1</code> を使ってfetchしていたため。Hugoから見たら最新のコミットの日時しかないように見えてしまう。</p><p>対応としては、<code>fetch-depth: 0</code> で全部のコミットをとる必要があった。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=c># for enableGitInfo</span><span class=w>
</span></span></span></code></pre></div><p>これ、チューニングオプションなんだから、デフォルトにするのやめてほしい。</p><p>追記: 気づいたらactions-hugoのREADME.mdに書かれてた(<a href=https://github.com/peaceiris/actions-hugo/commit/c55729fbd130889796da92d7859188dbbad0e32a>commit</a>)。これで詰まる人が減りますねえ。</p><footer><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://fukasawah.github.io/tags/hugo>#Hugo</a></span></p><p>Created at: 2020-04-02 09:34 +0900<br>Updated at: 2020-08-06 15:15 +0900 <a href=https://github.com/fukasawah/blog/commit/e55400aa7f43ec651fc0536a110fc172c22e2618 target=_blank rel=noopener>#e55400a</a></p><p><a href=https://fukasawah.github.io/posts/2020/04/08/frep/><span title="テンプレートエンジン frep">&lt; Next</span></a>
|
<a href=https://fukasawah.github.io/posts/><span title=Posts>Posts</span></a>
|
<a href=https://fukasawah.github.io/posts/2019/06/24/configure-azure-resources-with-pulumi/><span title=PulumiでAzureのリソースを構成する>Prev ></span></a></p></footer></article><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//fukasawah.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<script src=https://fukasawah.github.io/js/theme-posts.min.526bf4c8dff80bed936c62a06f7bc8c02703fad621e3dd2ba243812d43c40b98397ff1951e5905c790b97c38633d42a0e35bf5314fdf9fcfbce31b18181b8ae3.js integrity="sha512-Umv0yN/4C+2TbGKgb3vIwCcD+tYh490rokOBLUPEC5g5f/GVHlkFx5C5fDhjPUKg41v1MU/fn8+84xsYGBuK4w==" defer></script></main><footer><p>&copy; 2022 <a href=https://fukasawah.github.io/>fukasawah</a></p></footer></body></html>